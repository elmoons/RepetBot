# RepetBot: Telegram-бот для подготовки к ЕГЭ/ОГЭ по математике

![Python](https://img.shields.io/badge/Python-3.11%2B-blue.svg)
![Aiogram](https://img.shields.io/badge/Aiogram-3.x-blue.svg)
![CairoSVG](https://img.shields.io/badge/CairoSVG-2.x-green.svg)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-lightgrey.svg)

RepetBot — это Telegram-бот, разработанный для помощи школьникам в подготовке к государственным экзаменам (ЕГЭ/ОГЭ) по математике. Бот предоставляет возможность генерировать задания, получать их решения и работать с графическими формулами, представленными в формате SVG.

## Функционал

*   **Генерация заданий**: Пользователи могут выбрать номер задания ЕГЭ/ОГЭ по математике (от 1 до 19), и бот предоставит случайное задание соответствующего типа.
*   **Отображение формул**: Бот обрабатывает SVG-изображения математических формул, конвертируя их в PNG для корректного отображения в Telegram.
*   **Получение решений**: После получения задания пользователь может запросить его подробное решение.
*   **Регистрация пользователей**: Бот предлагает процесс регистрации, в ходе которого собирает ФИО, email и номер телефона пользователя для персонализации и, возможно, будущих функций.
*   **Управление данными**: Зарегистрированные пользователи могут просматривать свои данные и изменять их.

## Технологии

*   **Python 3.11+**: Основной язык разработки.
*   **Aiogram 3.x**: Асинхронный фреймворк для разработки Telegram-ботов.
*   **CairoSVG**: Библиотека для конвертации SVG-изображений в растровые форматы (PNG).
*   **requests**: Для выполнения HTTP-запросов к внешним ресурсам (например, для получения заданий и изображений).
*   **SQLAlchemy**: ORM для работы с базой данных.
*   **Alembic**: Инструмент для миграции баз данных.
*   **PostgreSQL**: Реляционная база данных для хранения информации о пользователях.

## Установка и запуск

Для запуска RepetBot вам потребуется Python 3.11+ и установленные системные зависимости для Cairo.

### 1. Клонирование репозитория

```bash
git clone https://github.com/elmoons/RepetBot.git
cd RepetBot
```

### 2. Создание и активация виртуального окружения

```bash
python3.11 -m venv .venv
source .venv/bin/activate
```

### 3. Установка Python-зависимостей

```bash
pip install -r requirements.txt
```

### 4. Установка системных зависимостей (Cairo для macOS/Linux)

`cairosvg` требует наличия системной библиотеки Cairo. 

**Для macOS (с Homebrew):**

```bash
brew install cairo
```

После установки Cairo, необходимо убедиться, что `cairocffi` может найти библиотеку. Добавьте следующую строку в ваш файл `~/.zshrc` (или `~/.bashrc`, если вы используете Bash) и перезапустите терминал или выполните `source ~/.zshrc`:

```bash
export DYLD_FALLBACK_LIBRARY_PATH="$(brew --prefix cairo)/lib:$DYLD_FALLBACK_LIBRARY_PATH"
```

**Для Debian/Ubuntu:**

```bash
sudo apt-get update
sudo apt-get install libcairo2-dev
```

### 5. Настройка базы данных

Бот использует PostgreSQL. Вам необходимо создать базу данных и настроить подключение.

Создайте файл `.env` в корневой директории проекта (`RepetBot`) и добавьте в него следующие переменные окружения:

```env
BOT_TOKEN=ВАШ_ТОКЕН_БОТА
DB_HOST=localhost
DB_PORT=5432
DB_USER=ваш_пользователь_бд
DB_PASS=ваш_пароль_бд
DB_NAME=имя_вашей_бд
```

Замените значения на свои данные.

### 6. Применение миграций базы данных

```bash
alembic upgrade head
```

### 7. Запуск бота

```bash
python src/main.py
```

## Использование бота

После запуска бота вы можете взаимодействовать с ним в Telegram:

*   `/start` - Начать взаимодействие с ботом.
*   `/registration` - Зарегистрироваться в боте, предоставив ФИО, email и номер телефона.
*   `/get_me` - Просмотреть свои регистрационные данные.
*   `/change_my_data` - Сбросить свои регистрационные данные для повторной регистрации.
*   `/generate_task` - Выбрать номер задания ЕГЭ/ОГЭ и получить случайное задание.

## Разработка и отладка

При разработке и отладке могут возникнуть проблемы с доступом к внешним ресурсам (например, `sdamgia.ru`) из-за блокировок или специфических требований сервера. В таких случаях рекомендуется:

*   Использовать заголовки `User-Agent` в `requests` для имитации браузера.
*   Скачивать проблемные изображения вручную и хранить их локально.
*   Рассмотреть использование браузерной автоматизации (Selenium/Playwright) для сложных случаев.


